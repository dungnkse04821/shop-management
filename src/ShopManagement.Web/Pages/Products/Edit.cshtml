@page "{id:guid}"
@model ShopManagement.Web.Pages.Products.EditModel
@{
    ViewData["Title"] = "Edit Product";
}
@section Styles {
    <link rel="stylesheet" href="~/Pages/Css/EditProduct.css" />
}

@section Scripts {
    <script src="~/Pages/Js/EditProduct.js"></script>
}
<h2>Edit Product</h2>
<div class="container mt-4">
    <div class="row align-items-start">
        <!-- Vùng hiển thị ảnh -->
        <div class="col-md-6 text-center mb-4 mb-md-0">
            @if (Model.ViewModel.Product.Images != null && Model.ViewModel.Product.Images.Any())
            {
                <!-- Carousel ảnh chính -->
                <div id="productImageCarousel" class="carousel slide carousel-fade mb-3" data-bs-ride="carousel" data-bs-interval="3000">
                    <div class="carousel-inner">
                        @for (int i = 0; i < Model.ViewModel.Product.Images.Count; i++)
                        {
                            var img = Model.ViewModel.Product.Images[i];
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <img src="@img.ImageUrl" class="d-block mx-auto main-image img-fluid rounded shadow" alt="Product Image">
                            </div>
                        }
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                </div>

                <!-- Thumbnails nhỏ bên dưới -->
                <div class="thumbnail-gallery d-flex justify-content-center flex-wrap gap-2">
                    @for (int i = 0; i < Model.ViewModel.Product.Images.Count; i++)
                    {
                        var img = Model.ViewModel.Product.Images[i];
                        <img src="@img.ImageUrl"
                             class="thumbnail-img rounded"
                             data-bs-target="#productImageCarousel"
                             data-bs-slide-to="@i"
                             alt="Thumbnail @(i + 1)">
                    }
                </div>
            }
            else
            {
                <p class="text-muted">No images uploaded yet.</p>
            }
        </div>

        <!-- Form chỉnh sửa nằm bên phải -->
        <div class="col-md-6">
            <form method="post" enctype="multipart/form-data">
                <input type="hidden" asp-for="ViewModel.Id" />

                <div class="form-group">
                    <label asp-for="ViewModel.Product.Sku"></label>
                    <input asp-for="ViewModel.Product.Sku" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="ViewModel.Product.Name"></label>
                    <input asp-for="ViewModel.Product.Name" class="form-control" />
                </div>
                <div class="form-group">
                    <label asp-for="ViewModel.Product.Description"></label>
                    <textarea asp-for="ViewModel.Product.Description" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label asp-for="ViewModel.Product.PriceBuy"></label>
                    <input asp-for="ViewModel.Product.PriceBuy" class="form-control" type="number" />
                </div>
                <div class="form-group">
                    <label asp-for="ViewModel.Product.PriceSell"></label>
                    <input asp-for="ViewModel.Product.PriceSell" class="form-control" type="number" />
                </div>

                <div class="form-group">
                    <table class="table" id="variantsTable">
                        <thead>
                            <tr>
                                <th>Variant Name</th>
                                <th>SKU</th>
                                <th>Stock</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                var i = 0;
                            }
                            @foreach (var pro in Model.ViewModel.Product.Variants)
                            {
                                <tr>
                                    <td>
                                        <input name="ViewModel.Product.Variants[@i].VariantName" value="@pro.VariantName" class="form-control" />
                                    </td>
                                    <td>
                                        <input name="ViewModel.Product.Variants[@i].Sku" value="@pro.Sku" class="form-control" />
                                    </td>
                                    <td>
                                        <input name="ViewModel.Product.Variants[@i].Stock" value="@pro.Stock" type="number" class="form-control" />
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger remove-variant">X</button>
                                    </td>
                                </tr>
                                i++;
                            }
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-primary" id="addVariant">+ Add Variant</button>
                </div>
                <br/>
                <div class="mb-3">
                    <label for="imageInput" class="form-label fw-bold">Thêm ảnh sản phẩm</label>
                    <input type="file" id="imageInput" name="ImageFiles" accept="image/*" multiple class="form-control" />
                @*     @if (Model.ViewModel.Product.Images != null)
                    {
                        @foreach (var img in Model.ViewModel.Product.Images)
                        {
                            <input type="hidden" name="ExistingImages" value="@img.ImageUrl" />
                        }
                    } *@
                </div>

                <div id="previewContainer" class="d-flex flex-wrap mt-3"></div>

                <button type="submit" class="btn btn-success">Save</button>
                <a asp-page="Product" class="btn btn-secondary ms-2">Cancel</a>
            </form>
        </div>
    </div>
</div>
